(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-9c15aa06"],{3641:function(e,t,s){"use strict";s("df48")},"3bae":function(e,t,s){"use strict";var a=s("2fa3");t.a={getPublicRoom:function(){return a.b.get("/rooms/4")},createPrivateRoom:function(e){return a.b.post("/rooms",{userId:e})},getPrivateRoom:function(e){return a.b.get("/rooms/".concat(e))},getNotification:function(){return a.b.get("/rooms/notifications")},getRoom:function(e){return a.b.get("/rooms/".concat(e))},getRoomsByUser:function(){return a.b.get("/rooms")},getAvailableUsers:function(){return a.b.get("rooms/availableUsers")},getUnread:function(){return a.b.get("/private/unread")}}},4655:function(e,t,s){e.exports=s.p+"img/send.376b4246.svg"},"521f":function(e,t,a){"use strict";var s=a("5530"),r=a("b572"),n=a("2708"),i=a("2fa3"),c=a("2f62"),s={name:"MessageBox",mixins:[n.a,n.c],components:{Spinner:r.a},props:{currentChat:{type:Object,default:function(){return{userId:void 0,name:"",account:""}}},messageList:{type:Array,required:!0},atPublic:{type:Boolean,default:!1}},data:function(){return{message:"",isProcessing:!1}},updated:function(){this.updateScroll()},methods:{messageCheck:function(e){return!!e.length||(i.a.fire({icon:"error",title:"尚未輸入訊息!"}),!1)},sendMessageHandler:function(){var e,t,s=this.message;this.messageCheck(s)&&(e=!this.messageList.length,t=this.atPublic?"chat message":"private chat message",this.sendMessage(t,s,e),this.message="",i.a.fire({icon:"success",title:"訊息已發送!"}))},sendMessage:function(e,t,s){return this.$socket.emit(e,{roomId:this.currentRoomId,newMessage:s,message:t},function(){})},toggleIsProcessing:function(){this.isProcessing=!this.isProcessing},updateScroll:function(){this.$refs.messageList.scrollTop=this.$refs.messageList.scrollHeight}},watch:{currentRoomId:function(){}},computed:Object(s.a)({},Object(c.b)(["currentUser","currentRoomId"]))},c=(a("f977"),a("2877")),s=Object(c.a)(s,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"messageBox"},[t.atPublic?[s("div",{staticClass:"title",on:{click:t.updateScroll}},[s("h1",[t._v("公開聊天室")])])]:[t.currentChat.name?s("div",{staticClass:"title private"},[s("h1",[t._v(t._s(t.currentChat.name||"UserName"))]),s("p",[t._v("@"+t._s(t.currentChat.account||"UserAccount"))])]):s("div",{staticClass:"title noChat"},[s("h1",[t._v("開啟聊天！")])])],s("div",{ref:"messageList",staticClass:"container"},[s("ul",{staticClass:"messageList"},[t.isProcessing?s("Spinner"):[t.messageList.length?t._l(t.messageList,function(e){return[0===e.type?s("li",{key:e.id,staticClass:"actionItem"},[s("p",[t._v(t._s(e.text))])]):s("li",{key:e.id,staticClass:"messageItem",class:{currentUser:e.UserId===t.currentUser.id}},[s("div",{staticClass:"mainContent"},[s("div",{staticClass:"avatar"},[s("img",{attrs:{src:t._f("emptyImageFilter")(e.avatar),alt:""}})]),s("div",{staticClass:"textContainer"},[s("div",{staticClass:"text"},[t._v(" "+t._s(e.message)+" ")])])]),s("div",{staticClass:"textTime"},[t._v(t._s(t._f("fromNow")(e.createdAt)))])])]}):s("div",{staticClass:"emptyList"},[s("img",{attrs:{src:a("b8c3"),alt:""}})])]],2)]),s("div",{staticClass:"meesagePanel"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.message,expression:"message"}],attrs:{id:"textInput",placeholder:"輸入訊息...",type:"text",maxlength:"160",required:"",disabled:void 0===t.currentChat.userId},domProps:{value:t.message},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendMessageHandler(e)},input:function(e){e.target.composing||(t.message=e.target.value)}}}),s("button",{staticClass:"btn sendBtn",attrs:{disabled:void 0===t.currentChat.userId,type:"submit"},on:{click:t.sendMessageHandler}},[s("img",{attrs:{src:a("4655"),alt:""}})])])],2)},[],!1,null,"46389459",null);t.a=s.exports},"62cf":function(e,t,s){},"655a":function(e,t,s){"use strict";s("62cf")},"6c36":function(e,t,s){e.exports=s.p+"img/newMessage.cfd494d4.svg"},"7c0d":function(e,t,s){},"7db0":function(e,t,s){"use strict";var a=s("23e7"),r=s("b727").find,n=s("44d2"),s="find",i=!0;s in[]&&Array(1)[s](function(){i=!1}),a({target:"Array",proto:!0,forced:i},{find:function(e){return r(this,e,1<arguments.length?arguments[1]:void 0)}}),n(s)},b8c3:function(e,t,s){e.exports=s.p+"img/conversation.873c4926.svg"},df48:function(e,t,s){},e39f:function(e,t,r){"use strict";r.r(t);var s,a,n=r("5530"),i=r("1da1"),c=(r("7db0"),r("b0c0"),r("d81d"),r("96cf"),r("c8e4")),o=[function(){var e=this.$createElement,e=this._self._c||e;return e("div",{staticClass:"title"},[e("h1",[this._v("選擇要發送訊息的用戶")])])},function(){var e=this.$createElement,e=this._self._c||e;return e("span",{attrs:{"aria-hidden":"true","data-dismiss":"modal","aria-label":"Close"}},[e("img",{attrs:{src:r("27ae"),alt:""}})])}],u=r("b572"),l=r("2708"),d=r("1157"),m=r.n(d),g={name:"UserChatListModal",mixins:[l.a],components:{Spinner:u.a},props:{allUserList:{type:Array,required:!0}},data:function(){return{isProcessing:!0}},methods:{userSelected:function(e){this.$emit("afterUserSelected",e),this.closeModal()},closeModal:function(){m()("#allUserList").modal("hide"),m()(".modal-backdrop").hide();var e=document.getElementsByClassName("modal-backdrop");document.body.removeChild(e[0])}},watch:{allUserList:{deep:!0,handler:function(){this.isProcessing=!1}}}},f=(r("3641"),r("2877")),d=Object(f.a)(g,function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("div",{staticClass:"modal fade",attrs:{id:"allUserList",tabindex:"-1",role:"dialog","aria-labelledby":"","aria-hidden":"true"}},[a("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[s._m(0),a("button",{staticClass:"start btn",attrs:{type:"button"},on:{click:s.closeModal}},[s._m(1)])]),a("div",{staticClass:"modal-body"},[a("ul",{staticClass:"userList"},[s.isProcessing?a("Spinner",{staticClass:"spinner"}):s._l(s.allUserList,function(t){return a("li",{key:t.id,staticClass:"userItem",on:{click:function(e){return s.userSelected(t)}}},[a("div",{staticClass:"userContainer"},[a("div",{staticClass:"avatar"},[a("img",{attrs:{src:s._f("emptyImageFilter")(t.avatar),alt:""}})]),a("div",{staticClass:"userInfo"},[a("p",[s._v(s._s(t.name))]),a("p",[s._v("@"+s._s(t.account))])])])])})],2)]),a("div",{staticClass:"modal-footer"})])])])},o,!1,null,"e3f63714",null).exports,g=r("521f"),v=r("2fa3"),h=r("3bae"),o=r("2f62"),p=r("4cce"),o={name:"privateMessage",components:{UserSidebar:c.a,UserChatListModal:d,MessageBox:g.a,Spinner:u.a},mixins:[l.a,l.c],data:function(){return{allUserList:[],receivedMessageList:[],currentChat:{id:void 0,name:"",account:""},currentMessageList:[],message:"",isProcessing:!0}},created:function(){var t=this;return Object(i.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.fetchReceivedMessageList();case 3:return e.next=5,t.fetchAvailableUser();case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0);case 10:case"end":return e.stop()}},e,null,[[0,7]])}))()},sockets:{message:function(e){v.a.fire({icon:"info",title:e.text})},"private chat message":(a=Object(i.a)(regeneratorRuntime.mark(function e(t){var s,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.userId===this.currentUser.id?((s=this.receivedMessageList.find(function(e){return e.roomId===a.currentRoomId}))?(s.lastTime=t.createdAt,s.lastMessage=t.text):this.receivedMessageList.push({account:this.currentChat.account,avatar:this.currentChat.avatar,lastMessage:t.text,lastTime:t.createdAt,name:this.currentChat.name,userId:this.currentChat.id,roomId:this.currentRoomId}),this.currentMessageList.push({id:this.currentMessageList.length+1,UserId:this.currentUser.id,type:1,avatar:this.currentUser.avatar,message:t.text,createdAt:t.createdAt})):((s=this.receivedMessageList.find(function(e){return e.userId===t.userId})).lastTime=t.createdAt,s.lastMessage=t.text,this.currentRoomId===s.roomId&&this.currentMessageList.push({id:this.currentMessageList.length+1,UserId:this.currentChat.userId,type:1,avatar:this.currentChat.avatar,message:t.text,createdAt:t.createdAt}));case 2:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)}),"users count":function(e){},"new private chat message":(s=Object(i.a)(regeneratorRuntime.mark(function e(t){var s,a,r,n,i,c,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=t[1],o=t[0],a=o.avatar,r=o.createdAt,n=o.text,i=o.userId,e.prev=3,e.next=6,p.a.getUser(i);case 6:c=e.sent,o=c.data,c=o.name,o=o.account,this.receivedMessageList.push({account:o,avatar:a,userId:i,lastMessage:n,lastTime:r,roomId:s,name:c}),this.currentChat.message.push(t),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3);case 16:case"end":return e.stop()}},e,this,[[3,13]])})),function(e){return s.apply(this,arguments)}),"notice from private":function(e){}},methods:{fetchReceivedMessageList:function(){var s=this;return Object(i.a)(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s.isProcessing=!0,e.next=4,h.a.getRoomsByUser();case 4:t=e.sent,t=t.data,s.receivedMessageList=t.map(function(e){var t=e.userId,s=e.name,a=e.account,r=e.avatar,n=e.roomId,i=e.message;return{userId:t,name:s,account:a,avatar:r,roomId:n,lastTime:e.createdAt,lastMessage:i}}),s.isProcessing=!1,e.next=15;break;case 10:e.prev=10,e.t0=e.catch(0),s.isProcessing=!1;case 15:case"end":return e.stop()}},e,null,[[0,10]])}))()},passChatData:function(a){var r=this;return Object(i.a)(regeneratorRuntime.mark(function e(){var t,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.roomId,s=a.userId,r.currentChat.userId===s)return e.abrupt("return");e.next=4;break;case 4:return r.currentChat=a,r.$refs.messageBox.toggleIsProcessing(),r.currentRoomId&&(r.$socket.emit("leave",r.currentUser.id,r.currentRoomId),r.$store.commit("setCurrentRoomId",void 0)),e.prev=8,e.next=11,h.a.getRoom(t);case 11:s=e.sent,s=s.data,s=s.messages,r.currentMessageList=s.map(function(e){return Object(n.a)(Object(n.a)({},e),{},{type:1})}),r.$refs.messageBox.toggleIsProcessing(),r.joinPrivateRoom(t),r.$store.commit("setCurrentRoomId",t),e.next=25;break;case 21:e.prev=21,e.t0=e.catch(8),v.a.fire({icon:"error",title:e.t0});case 25:case"end":return e.stop()}},e,null,[[8,21]])}))()},afterUserSelected:function(e){this.currentMessageList=[],this.currentChat=Object(n.a)(Object(n.a)(Object(n.a)({},this.currentChat),e),{},{userId:e.id});e=this.currentChat.id;this.createNewChat(e)},createNewChat:function(a){var r=this;return Object(i.a)(regeneratorRuntime.mark(function e(){var t,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.a.createPrivateRoom(a);case 3:if(s=e.sent,t=s.data,s=t.roomId,"success"!==t.status)throw new Error(t.message);e.next=10;break;case 10:v.a.fire({icon:"success",title:"已建立連線！"}),r.$socket.emit("leave",r.currentUser.id,r.currentRoomId),r.joinPrivateRoom(s),r.$store.commit("setCurrentRoomId",s),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0);case 19:case"end":return e.stop()}},e,null,[[0,16]])}))()},joinPrivateRoom:function(e){this.$socket.emit("join",{username:this.currentUser.name,roomId:e,userId:this.currentUser.id})},fetchAvailableUser:function(){var s=this;return Object(i.a)(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.a.getAvailableUsers();case 3:t=e.sent,t=t.data,s.allUserList=t,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0);case 11:case"end":return e.stop()}},e,null,[[0,8]])}))()},showModal:function(){m()("#allUserList").appendTo("body"),m()("#allUserList").modal("show")}},computed:Object(n.a)({},Object(o.b)(["currentUser","currentRoomId"]))},o=(r("655a"),Object(f.a)(o,function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("div",{staticClass:"publicMessage flex"},[a("UserSidebar"),a("div",{staticClass:"mainSection flex"},[a("div",{staticClass:"usersOnline"},[a("div",{staticClass:"title stickyTitle"},[a("h1",[s._v("訊息")]),a("div",{staticClass:"newMessage"},[a("button",{staticClass:"btn",attrs:{type:"button"},on:{click:s.showModal}},[a("img",{attrs:{src:r("6c36"),alt:""}})])]),a("UserChatListModal",{attrs:{allUserList:s.allUserList},on:{afterUserSelected:s.afterUserSelected}})],1),a("div",{staticClass:"container"},[a("ul",{staticClass:"userList"},[s.isProcessing?a("Spinner"):[s.receivedMessageList.length?s._e():[a("p",{staticClass:"noReceivedMessageList"},[s._v("還沒有任何對話")])],s._l(s.receivedMessageList,function(t){return a("li",{key:t.userId,staticClass:"userItem",on:{click:function(e){return s.passChatData(t)}}},[a("div",{staticClass:"avatar"},[a("img",{attrs:{src:s._f("emptyImageFilter")(t.avatar),alt:""}})]),a("div",{staticClass:"userContainer"},[a("div",{staticClass:"row"},[a("div",{staticClass:"userName"},[a("p",[s._v(s._s(t.name))])]),a("div",{staticClass:"userAccount"},[a("p",[s._v("@"+s._s(t.account))])]),a("div",{staticClass:"lastTime"},[a("p",[s._v(s._s(s._f("fromNow")(t.lastTime)))])])]),a("div",{staticClass:"previewMessage"},[a("p",[s._v(" "+s._s(t.lastMessage)+" ")])])])])})]],2)])]),a("MessageBox",{ref:"messageBox",attrs:{currentChat:s.currentChat,messageList:s.currentMessageList}})],1)],1)},[],!1,null,"4d4981fd",null));t.default=o.exports},f977:function(e,t,s){"use strict";s("7c0d")}}]);