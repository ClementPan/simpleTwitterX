(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4a2d9787"],{"3bae":function(e,s,t){"use strict";var a=t("2fa3");s.a={getPublicRoom:function(){return a.b.get("/rooms/4")},createPrivateRoom:function(e){return a.b.post("/rooms",{userId:e})},getPrivateRoom:function(e){return a.b.get("/rooms/".concat(e))},getNotification:function(){return a.b.get("/rooms/notifications")},getRoom:function(e){return a.b.get("/rooms/".concat(e))},getRoomsByUser:function(){return a.b.get("/rooms")},getAvailableUsers:function(){return a.b.get("rooms/availableUsers")},getUnread:function(){return a.b.get("/private/unread")}}},"3fee":function(e,s,t){"use strict";t("f437")},4655:function(e,s,t){e.exports=t.p+"img/send.376b4246.svg"},"521f":function(e,s,a){"use strict";var t=a("5530"),n=a("b572"),i=a("2708"),r=a("2fa3"),c=a("2f62"),t={name:"MessageBox",mixins:[i.a,i.c],components:{Spinner:n.a},props:{currentChat:{type:Object,default:function(){return{userId:void 0,name:"",account:""}}},messageList:{type:Array,required:!0},atPublic:{type:Boolean,default:!1}},data:function(){return{message:"",isProcessing:!1}},updated:function(){this.updateScroll()},methods:{messageCheck:function(e){return!!e.length||(r.a.fire({icon:"error",title:"尚未輸入訊息!"}),!1)},sendMessageHandler:function(){var e,s,t=this.message;this.messageCheck(t)&&(e=!this.messageList.length,s=this.atPublic?"chat message":"private chat message",this.sendMessage(s,t,e),this.message="",r.a.fire({icon:"success",title:"訊息已發送!"}))},sendMessage:function(e,s,t){return this.$socket.emit(e,{roomId:this.currentRoomId,newMessage:t,message:s},function(){})},toggleIsProcessing:function(){this.isProcessing=!this.isProcessing},updateScroll:function(){this.$refs.messageList.scrollTop=this.$refs.messageList.scrollHeight}},watch:{currentRoomId:function(){}},computed:Object(t.a)({},Object(c.b)(["currentUser","currentRoomId"]))},c=(a("f977"),a("2877")),t=Object(c.a)(t,function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",{staticClass:"messageBox"},[s.atPublic?[t("div",{staticClass:"title",on:{click:s.updateScroll}},[t("h1",[s._v("公開聊天室")])])]:[s.currentChat.name?t("div",{staticClass:"title private"},[t("h1",[s._v(s._s(s.currentChat.name||"UserName"))]),t("p",[s._v("@"+s._s(s.currentChat.account||"UserAccount"))])]):t("div",{staticClass:"title noChat"},[t("h1",[s._v("開啟聊天！")])])],t("div",{ref:"messageList",staticClass:"container"},[t("ul",{staticClass:"messageList"},[s.isProcessing?t("Spinner"):[s.messageList.length?s._l(s.messageList,function(e){return[0===e.type?t("li",{key:e.id,staticClass:"actionItem"},[t("p",[s._v(s._s(e.text))])]):t("li",{key:e.id,staticClass:"messageItem",class:{currentUser:e.UserId===s.currentUser.id}},[t("div",{staticClass:"mainContent"},[t("div",{staticClass:"avatar"},[t("img",{attrs:{src:s._f("emptyImageFilter")(e.avatar),alt:""}})]),t("div",{staticClass:"textContainer"},[t("div",{staticClass:"text"},[s._v(" "+s._s(e.message)+" ")])])]),t("div",{staticClass:"textTime"},[s._v(s._s(s._f("fromNow")(e.createdAt)))])])]}):t("div",{staticClass:"emptyList"},[t("img",{attrs:{src:a("b8c3"),alt:""}})])]],2)]),t("div",{staticClass:"meesagePanel"},[t("input",{directives:[{name:"model",rawName:"v-model",value:s.message,expression:"message"}],attrs:{id:"textInput",placeholder:"輸入訊息...",type:"text",maxlength:"160",required:"",disabled:void 0===s.currentChat.userId},domProps:{value:s.message},on:{keyup:function(e){return!e.type.indexOf("key")&&s._k(e.keyCode,"enter",13,e.key,"Enter")?null:s.sendMessageHandler(e)},input:function(e){e.target.composing||(s.message=e.target.value)}}}),t("button",{staticClass:"btn sendBtn",attrs:{disabled:void 0===s.currentChat.userId,type:"submit"},on:{click:s.sendMessageHandler}},[t("img",{attrs:{src:a("4655"),alt:""}})])])],2)},[],!1,null,"46389459",null);s.a=t.exports},"7c0d":function(e,s,t){},b8c3:function(e,s,t){e.exports=t.p+"img/conversation.873c4926.svg"},f437:function(e,s,t){},f977:function(e,s,t){"use strict";t("7c0d")},ffce:function(e,s,t){"use strict";t.r(s);var a=t("5530"),i=t("1da1"),n=(t("96cf"),t("c8e4")),r=t("521f"),c=t("b572"),o=t("2708"),u=t("2fa3"),l=t("2f62"),m=t("3bae"),l={name:"publicMessage",components:{UserSidebar:n.a,MessageBox:r.a,Spinner:c.a},mixins:[o.a,o.c],data:function(){return{currentChat:{userId:"publicRoom",name:"公開聊天室",account:""},message:"",messageList:[],onlineUsersCount:1,onlineUsers:[],atPublic:!0,isProcessing:!0}},mounted:function(){var n=this;return Object(i.a)(regeneratorRuntime.mark(function e(){var s,t,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n.isProcessing=!0,n.$refs.messageBox.toggleIsProcessing(),e.next=5,m.a.getPublicRoom();case 5:t=e.sent,a=t.data,s=a.messages,t=a.onlineUsersCount,a=a.onlineUsers,n.messageList=s,n.onlineUsers=a,n.onlineUsersCount=t,n.$refs.messageBox.toggleIsProcessing(),n.isProcessing=!1,e.next=20;break;case 15:e.prev=15,e.t0=e.catch(0),n.isProcessing=!1,u.a.fire({icon:"error",title:e.t0});case 20:case"end":return e.stop()}},e,null,[[0,15]])}))()},sockets:{"chat message":function(e){this.messageList.push({id:this.messageList+1,UserId:e.userId,type:1,avatar:e.avatar,message:e.text,createdAt:new Date})},"users count":function(e){var s=e.users,e=e.userCount;this.onlineUsers=s,this.onlineUsersCount=e,this.message=""},message:function(e){this.messageList.push({id:this.messageList.length+1,type:0,text:e.text}),this.message=""}},methods:{},computed:Object(a.a)({},Object(l.b)(["currentUser"]))},t=(t("3fee"),t("2877")),l=Object(t.a)(l,function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",{staticClass:"publicMessage flex"},[t("UserSidebar"),t("div",{staticClass:"mainSection flex"},[t("div",{staticClass:"usersOnline"},[t("div",{staticClass:"title stickyTitle"},[t("h1",[s._v("上線使用者 ("+s._s(s.onlineUsersCount)+")")])]),t("div",{staticClass:"container"},[t("ul",{staticClass:"userList"},[s.isProcessing?t("Spinner"):s._e(),s._l(s.onlineUsers,function(e){return t("li",{key:e.id,staticClass:"userItem"},[t("div",{staticClass:"userContainer"},[t("div",{staticClass:"avatar"},[t("img",{attrs:{src:s._f("emptyImageFilter")(e.avatar),alt:""}})]),t("div",{staticClass:"userName"},[t("p",[s._v(s._s(e.name))])]),t("div",{staticClass:"userAccount"},[t("p",[s._v("@"+s._s(e.account))])])])])})],2)])]),t("MessageBox",{ref:"messageBox",attrs:{currentChat:s.currentChat,atPublic:s.atPublic,messageList:s.messageList}})],1)],1)},[],!1,null,"3d63ecae",null);s.default=l.exports}}]);